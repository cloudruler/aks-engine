#cloud-config

write_files:
- path: /opt/azure/containers/provision_source.sh
  permissions: \"0744\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').provisionSource,'

- path: /opt/azure/containers/provision.sh
  permissions: \"0744\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').provisionScript,'

- path: /opt/azure/containers/provision_installs.sh
  permissions: \"0744\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').provisionInstalls,'

- path: /opt/azure/containers/provision_configs.sh
  permissions: \"0744\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').provisionConfigs,'


- path: /usr/local/bin/health-monitor.sh
  permissions: \"0544\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').healthMonitorScript,'
- path: /etc/systemd/system/kubelet-monitor.service
  permissions: \"0644\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').kubeletMonitorSystemdService,'

- path: /etc/systemd/system/etcd-monitor.service
  permissions: \"0644\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').etcdMonitorSystemdService,'

- path: /etc/systemd/system/kubelet.service
  permissions: \"0644\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').kubeletSystemdService,'
- path: /etc/systemd/system/docker-monitor.service
  permissions: \"0644\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').dockerMonitorSystemdService,'



- path: /etc/apt/apt.conf.d/99periodic
  permissions: \"0644\"
  owner: root
  content: |
    APT::Periodic::Update-Package-Lists \"0\";
    APT::Periodic::Download-Upgradeable-Packages \"0\";
    APT::Periodic::AutocleanInterval \"0\";
    APT::Periodic::Unattended-Upgrade \"0\";

- path: /etc/systemd/system/docker.service.d/exec_start.conf
  permissions: \"0644\"
  owner: root
  content: |
    [Service]
    Restart=always
    ExecStart=
    ExecStart=/usr/bin/dockerd -H fd:// --storage-driver=overlay2 --bip=',parameters('dockerBridgeCidr'),'
    ExecStartPost=/sbin/iptables -P FORWARD ACCEPT
    #EOF

- path: /etc/docker/daemon.json
  permissions: \"0644\"
  owner: root
  content: |
    {
        \"live-restore\": true,
        \"log-driver\": \"json-file\",
        \"log-opts\": {
            \"max-size\": \"50m\",
            \"max-file\": \"5\"
        }
    }



- path: /etc/sysctl.d/11-aks-engine.conf
  permissions: \"0644\"
  owner: root
  content: |
    net.core.message_burst = 80
    net.core.message_cost = 40
    net.core.somaxconn = 16384
    net.ipv4.neigh.default.gc_thresh1 = 4096
    net.ipv4.neigh.default.gc_thresh2 = 8192
    net.ipv4.neigh.default.gc_thresh3 = 16384
    net.ipv4.tcp_max_syn_backlog = 16384
    net.ipv4.tcp_retries2 = 8
    #EOF

- path: /etc/kubernetes/certs/ca.crt
  permissions: \"0644\"
  encoding: base64
  owner: root
  content: |
    ',parameters('caCertificate'),'

- path: /etc/kubernetes/certs/client.crt
  permissions: \"0644\"
  encoding: \"base64\"
  owner: \"root\"
  content: |
    ',parameters('clientCertificate'),'

- path: /var/lib/kubelet/kubeconfig
  permissions: \"0644\"
  owner: root
  content: |
    apiVersion: v1
    kind: Config
    clusters:
    - name: localcluster
      cluster:
        certificate-authority: /etc/kubernetes/certs/ca.crt
      
        server: ',concat('https://', variables('masterPrivateIpAddrs')[copyIndex(variables('masterOffset'))], ':443'),'
      
    users:
    - name: client
      user:
        client-certificate: /etc/kubernetes/certs/client.crt
        client-key: /etc/kubernetes/certs/client.key
    contexts:
    - context:
        cluster: localcluster
        user: client
      name: localclustercontext
    current-context: localclustercontext
    #EOF

- path: /etc/kubernetes/manifests/kube-addon-manager.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/5STyW7bQAyG73oKIj3LalDk0LmlWVqjsC2gy7WgR7RDeBZ1hlKgty80srwEiZyepOGQH3/+lLDm3xQie6egvc527CoFpa8yS4IVCqoMwKElBbtmTTlWlXe5RYdbCvurWKMe72MXhWwG0J5QAQyuycSeBYB1/Sos1qT7jDqwDyzdncEYl6n1QM2dryjXgYU1mgzgyUdZkjz7sFMgoaEMQHsnyI5C6pZPaQdgi1tSYHWYWdbBR7+Rmfa28DEWfU1wJDS8nper9vPsevbpSCkbY0pvWHcK5pullzJQJCcpg1w7zD7q+f7ry8Pdavk4/5rCAC2ahhRcFS2GwvA6tTQk6am92/D26oxwe3+/Wv4pb39+e0kg0afak+xYsGMZCIGib4Km/Tr6wN+GohzOALpuFNzYw9mS9aFTcPNxwSnYetNYWvjGjWWjrqHdvtL2CSXKk4IJWQcZWK2c6Q6rPEJt5FeIo1XPiFtyUizSaqp5RU5YuvwHibDbxsv8FkNueJ3vTZ/odZ4xgSTR+XHci368BRyMPvuWTxzuf4CE25fX77D6padvMP7D3CkXL9CPqRO+vWvK7MPD6jH7FwAA//+80EWUzwQAAA==

- path: /etc/kubernetes/manifests/kube-apiserver.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/5xWb28axxN+z6c45feW5Qx2nPxQrxIhNI7kONSkSauqQsPucGzZ27nuzhGTT1/tHQfHX1u1JQQ7z/PM3PzZG8j1V3Rek+1Hq25rqa3qR2NSrQwZFDD0W1FkIcN+tCxmKCDXHt0K3ebY5yBrm197xqwVRQZmaHxgRhFrdP1IkmVHRuQGLJbnkrKcLFo+EvY5ysDNnSaneT004P1DGULlQVhSKKTTrCWYVhQtyPMD8ndyy37ErggegkfQFt0mDnHuKcKfziDFfpRJ18m0dORpzh1JWUzex4HhLDJWX3fk/qrb6b7tdG+bKuPCmDEZLdf96OP8gXjs0KPlDUZSlkHI8Z+v9sVe/bVBgEt9MAsBaoWOtUcBSjn0PvlpezRQyv38qh0FmDH0XeROr7TBFFUSMrAxWbLrjAovoOBFMgfja0uhNAtDqcjgCVJMrq9OGGYgl0WedE/ZvP6BSffqyJQDL5J4BS42lJYZK21x+dkxlDYJeZkpMdcGkxhZNpMNSpH1cRPYWUNmaj4vyOkfwJqsyEhh8kAK24/vBsMKMdNWbTN31Sn/K4s0Gi0LCacdS3TsYwkd6bgmUKGEJDvX6XGcPwqHnb892SY4d7TSCl1SmisLWpiZUM1M+zByIjdFqq1PHupJutdzlGtpsH2vM82PYFN07Qm6lZY4kJIKy+33OIfC8ITJQYrleNRnX8igK1MyQUlW+fZXMFoBa5sOarffcLYgWrYf0VPhJP5aEEN79MRoFar6dCfVHpOaoCzCMFatvfc4MyL27CAXTEu0VavtehBZKiHhhZmu0Oj4Aj5gqhIe8Ja4fhltiesGrRpAnyyYc9+P427vTdkt3X7v+s3/K6C2PmQARU6Ok00fBRcGedtPYTTnWgKffdKDqA8Elri+TNzGnTuaa6Nt2pzp3NHTuhnMpfYuwbtI9rhLPDOSTeo2Fof/FOh5gaDQVbcRKlG+HJJTiBdN3yaeRmfsi+ATOxDVDy9yh3P9lPwuHjEjRjEqrad4qaMir3k7wodwfApfeHThUY4pv3l0FaPZGTc31/VhObMCqqF9Lqfb98Aur4cKhihcxrvJqgHSFJ7RCZ0LFy6MpLu57eLu7QZZXRUi3OdoVRLafhMnG/9sr+yC21ajpOl8gU74QjP65Mv9ZDoavr8bTR8ng+m3j1/upsO7wfBu0Luajj/f/9G9vnrd3oFGw/cvgW21BqPJtNt7O/0w/DSd3A16r29Pi13E7an1Xt/WqOu3N+fVzuKOYhu+GwbU5cCOQUdRPavTAO3KETYAYPwPnbZKbrbrx4pMkeGn0HGbzam5PSFLsVPcmqMoC4Qx8KIfHbg9qeG9KbvukoT3Jt7H1AorcMLoWX19ntEoVxA9iw9RtUrm9TPM7wApWo4/gYUU1UeFljWvxQQ5vFCbwTsE9dma9Xb/3PflSS7POKP8OLRy5zGUXoqvuVy16rodLLsnyxW25VJoq56frdulml3U2S/e5cKdFTpVwePqPUt/URlPVOqscF2yM+W6HNBe3f43+vxL698AAAD//8wcSOqEDQAA

- path: /etc/kubernetes/manifests/kube-controller-manager.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/4xVTW/jRgy9+1cMciwykh3sFoUAnRY9BOimBgL0UvRAj2iZ9cxQ4FDaur++GFl2HH82pyB87/GRb8RAR3+gJOJYmWEx21JsKrPkZhZQoQGFamZMhICV2fYrtI6jCnuPYgNEaFGmeurAHUBplxTDzBgPK/QpSxijhFKZiW87DxHHvzsOHUeMertD6tBlkU6IhXT3zUNKb6OpfSsbuUHrhJQc+JkxG076hvqDZVsZlT63ysJAEWUyZB/OlX8oQIuVCU6KQE448VoLx6HklMpMlYiK+1+vqFTDolj8Uix+PpVb9t4v2ZPbVeZ1/ca6FEwYdcI4DgFyDn8+3VB9+muCgrQp46wF79mB4rQKaiTVa/AJn57Nk7XOc99kpTW1dYnqTr3Dv71g8XfieAruhAdqUOqxfKj0SVFG/XoxL16+zIt5MS8XL5/rebP1KCO9R4FtwthSPFNJ1EaKrXUoatfk8cJZrqTSQeFEr3O3uHtA3eJuoo7T94LTgMK94uctHTed6p+eV8yaVKDLvVCelbcYnUeIKHv8GkGzXgtZ6Dd24N+VBVr8Bh040t1rYg9KHOv8Cp/fUQZy+MYN/vpPHuVQ2etl+4eMBpDS02ocyaOWH7U91iM0KBY9Oj2RGOMPHElZbCvg0HYoxE39ZZ72kI4biwO5bMsqBeRe66/hWBZek6fYnm5GmNU6+L8pjau1kg078jRu4OBjcWiU9suw4Bz3UW0nNOQX/CBS6CgzUT6SVZRAERSbcbjWWd0Ipg37pv46n8/3qD7hRU8n2GBUAp9OljjUL8dPbGDfB/ye0dPhOD0eqM5+ODyWjQmZsATdVOZsjKsaKfk75M9VQWh+j353vGyf5RyMHxStKd+DW576JGW+GL5MGxAsb7PO2l30G0Csp5WdHuqNfmfP+UIlJHrA/AHQYtTy+3gDm9cxN93Zd1Sl2N6xfAjx7PBfzS7/5xgbH+W6myFeD/CuwgF2P6ybEo9Smz0O5qb2tYQu03lIfxjTfwEAAP//ExjK2nMIAAA=

- path: /etc/kubernetes/manifests/kube-scheduler.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/4SSMY/bMAyF9/wKIXMVIx2KQkCmTjfc1UCBLkUHRqYdIpJoULQP/veFEtdJL0njySD5Hh8/CHr6iZKJkzPjdnWk1DhTc7OKqNCAglsZkyCiM8dhjzb7AzZDQJnLuQe/9KasGFfGBNhjyEVpjBKKM56TCgfbB0h4qnuOPSdMemOce/RF2wuxkE7fAuT8dopw3mATN2i9kJKHsDLmwFnfUN9Zjs6oDGVD2QiUUOYc9tEV5aMIHToTvWwieeHMrW48x4pzropCEiqefy9iN24326+b7Zdrl3oIoeZAfnLmpX1jrQUzJp1nPMcIhfGv9b9m69/zBEiXS9vaMuA5tdTtqhGkCrQ/JQio1aW3/mTW1gaEBsViQK+7guBc7oVbCpS6XQshz8Vx93nZNnIYIr7ykHQGdQ0L1dvL+UvbmFgENejBmQrVV3eG/nqMIDbQ3s7JH5h8uO/GJWZ6onwH6DBp9QoJOmxeGkxKOtkfqEqpu04vCM33FKblsZwpfHgpd48vT+20eLHrH1L4P4GHTvdQ3GJ4Kn/K408AAAD//+KoAOX7AwAA





- path: /etc/kubernetes/addons/audit-policy.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/5ySy07rQAyG93kKK8uj01bsUF6ADSAUBBvEwp2Y1GoyHsae0L49yqWlrQCJ7Oby+/fnCwZ+pqgsvgBMFdtye61LllV3lW3ZVwU8SMNun0nL9mhYkxYZwAJKek+kVpIj7qjKYmoOXw111BRfCg3ilTIAgEgqKbpR2WvrKCkUkOfD/VQAL3mQSvPXU887MqzQcKbZqpE6/w/jWQ0tXfjfix9Bk1IcwnSvRm2xTWtahCi7/RAA0FFcD4IPNLeZHv9GRL4Kwt60R1KKHTv6jeemNzuFwmQb8sYOjaoJwYsvpyRP5e0RZIWB/x3O3Tjxb4Y1owon/o3rFoMeCLAlDTh9D40bec9Lm59RyUUynW13vNPOyPed0B937Hztx+jL1f8MAAD//62kjQpEAwAA

- path: /etc/kubernetes/addons/azure-cloud-provider.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/9SVT4/aPBDG7/4UFpdcXvOqtyq3dg+99J9A6mW1qib2EFwSO/KMI7GfvrLNLoWNEGgL2t4ihxk/z2+eDEopAYP9gYGsd7UMDeg5RF77YB+BrXfzzXuaW///+E5srDO1vOsiMYaF71D0yGCAoRZSdtBgR+lJyk1sMDhkzKW6VCjCMFqNtZxxiDgTUjrosZa0Jca+hscYUOnOR6OG4EdrMIgQO6RaKAmD/RR8HKiW97PZg5AyIPkYNOYTHNEx5fMRQ5N1KKkDAmN+HID1Oj/FwaTD11n/aJ2xrr0FAd/hAlep7RODE2KFlC/HdM41FJtfqDmzLh2WRewHrX10/Nxksrq8pAGSueRdlbteSfkA74SHIbUlRsdq9F3sUTXWFT2XD2MyalV1HLWKUAdkqvZZS3fI+6pFrv6rSuaqhysE7OoE9lGbCtF58btE5NmhO2Hz+sG7ynetSoxUi8wX7Lld+I4XXYv8ryy0Y+M3WW9Hl95o2RH7AC3usTfI8MR+WV7edUA08ZUbXEHskhJwznOGsBvFrq1OlfPUcn44HEtqV63yb/6YzuUTza6THQz1UUmBYyxtxAABemQMtF8eX8BBi0Y8C4YCl7cDJvvgDATz8/NiKaTUoNfWtb03WMsFgvnmuu1fBdoXOWoI2NvYvwT7dth8LxJvjoZ2M3nLbM7OzYTzk7wmuGShK1v+/K4OJF90CIQ28WtWcuD6dwAAAP//NH/WfLULAAA=

- path: /etc/kubernetes/addons/azure-cni-networkmonitor.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/5RUTY/bNhC9+1cMFuhRlpMiRcBbkGzRAl3HiLu909TYJkxytMOhavXXF5RsryTb2y2PnHnvzbeu7V/I0VJQoOs6ls2H2cGGSsE3jZ7CGmXmUXSlRasZQNAeFeh/EmNhgi0Cyt/EB0/BCvHJIdbaoIJD2mAR2yjoZwBOb9DFzAFZ6ZXEx/6vqih4HfQOeZ6hHFAwzi2VnipU8AMNBWMdzmKNJhNFdGiEuCf1Wsz+j4EKwOFzLK61Ul1pwbWwFty1va+0dZYg52zYPXcO3T8Pf860Xh+fg260dXrjUMGnxU8zAEFfu4vXsGj5uVFg90LrChECiRZLYeBuXIqCXOgkFI12VzWqunZFlKKmSsGDcMKHDn6uVn41W2Ir7VenY1x2vewbVASqsDBsxRrtTt5CDnkcSQEHbBV8PTl+yU2L34NrL5FSnTHECh6PNkocAzsZJofTFuuc3i2Sl3SJB6DRLuEou/xwu0UjCpa0NnusksOL6CvRQx/OLdTjEU2S/wmaSOXE1qN57Lo8SpKiAmdDOp7shoJoG5AHjS4mK3YZi/ys1ztU4A3PvTVMkbYyN+TLC9NpH23YlePVVM1ivph/npKtknMrcta0Cn7fLklWjBGDDPwimtTNDAXBo6iBqRuoxjrcYaUgN2VgZIyU2GAcIxhfEkaZ/AKYOin4eeEn3x49cavg46cnOzI56+0dlo+LN2h+GfFgaMYU5/r/9n395/LL0+OEpxvAX5n8VBhga9FVP3B7bckH7/XMNh9uOHTglZa96vZ1nscp7+fAtSGXPD5RCuO0zxHjRvI5igUnhwVjTSMdn4G9QtloLjmFGySOdm+ixvYzStChR+H2LpZqKU2w5caeVfcUZdmP6Gh0+jQHB+c6sAzteAdy9b0Y+8v+zXK3mu3s3UX7DxVOoXy3zHWB3mC/rtUtgX8DAAD//7FW8xO6BwAA

- path: /etc/kubernetes/addons/blobfuse-flexvolume.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/6SUQW/7NgzF7/4UQoEdHaeHAYVuw9pDgbUIlnV3RmYcIZSoiVQQf/vBcdLaSVsU+OtI8v2ixxcZkv8Xs3iO1kBK0hzuq72PrTWPgIHjGrUKqNCCgq2MiRDQmg3xZlsE6y3h8cBU+ygKRJjPI5LAoTX7ssFaelEMlTEEGyQZKMbsH6SGlD5QY7VsMEdUlIXnxlERxVwL5oMfcHeaC95VktANlJJaUFxrBsWuH7naJ7TmbybysXs7DZzqeVoZR40JcHyLcABPsCG05vflb5UxgoROOY9TAdTt/prc/HoHlTGKIdE7d7qu4dBM/Il8PD/zPs5CjKygnuOEe5FAURYHhHkxZ7anRAW1TtzOiJeNDidlz9lr/yeByOvprmOC9eUHXPbqHdDlMtutj177iUNu8Y+bqjEZ/ys+Y/tYso/d2u2wLUMqz13k9/LTEV0ZrE2VI3N9TuYfzEHm7XoM6umYMorMF3OZ2GNvDXQYNTHTVdsYTphhyN28sj7Hm/4BqOANdgBvCdRBPnccRwUfMb/P1j95NuPxATq0Jri8CN5lFt7qwnFo9g/SnGUlYHONKgHt/WK5eJiTVoVoxeRdb83z9pV1lVEwavURiXDJbu5ryAlFr7y6VIYnEmbFgIFzb839cvniJx3ywf8CYHT0wiVOIZc9HpgSlc5HmaDCMLwC3VnToLrm47/fjLSzpLnFQSbuvkAdIDfE3UU1om6SvULsWEb9BJo+5X1j6RvIT/xNH4z94ivDYg35WI7V/wEAAP//iqrT+wgGAAA=

- path: /etc/kubernetes/addons/coredns.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    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

- path: /etc/kubernetes/addons/secrets-store-csi-driver.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    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

- path: /etc/kubernetes/addons/ip-masq-agent.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/8xVwW7jNhC96ysGAXqklGSxRiqghyKbQ4AkDTbY3ifU2CFMcmhyqFpFP76gZDtSdtPu9lT6Npz3Zub5UYPB/E4xGfYtYAip6S+qrfFdC5+QHPsnksqRYIeCbQXg0VEL+GeOpExQDtNO4Ya8HO5SQE0tbPMzqTQkIVcBWHwmmwocQLML7MnLeywwgqMnoVQbbrTNSSiqRLE3hftMYqazMRO7jr1DjxuK9RLmuKMWPpNmr42lMV0MxRY8d1SlQLo0lEOHQk8SUWgzTC3KEAqUrTV+82VMGONxHplSARzuv3js0Vh8ttTCx/OfKoBElrRwnLIcin65m4kAsL1KCkN4X4RFtwBCLthT2fk/Uo5dcH8X+xv+UU3vWVAM+xnVUX7Mwkmj/UrobvRJIlGBu8W/c9S4nBANRyPDtcWUHkYTTfZQpQGloxGj0R6yXzjJA8kfHLctFMJDvOQ+LaT92i+cWrDG5/1RRrYUl1Mp2NLQwvWh6K/FRek3b4cTJYeC4djCzd4kSUvg2HJkS289h0Wqb5Hs8mk2gB5tXvq4HFqvSUsLD/ykX6jLlk5FX4nOpna+hbrZk87yg6A3pTR7QeMpzqT6pxc/HeNwQy04HWtndOTEa6k1u4ZTal4Vahbotr+sP9bnS5LHbO0jW6OHFm7XDyyPkdK8FMbNzJulPaXIl5enTOhXv6zRJjrdJ9J5NB17ob3MgSGa3ljaULcwGEDPNju65+zlTaV3hVCa/dps1ASdYQBc4XlEeWmhIdHNlHlKiZQ4R02LSpF2mdKyOoAOuXxc3JKeHMehxO/N7MIaZ34IfzkjmKaYof/L5FP8HsOyiX8jqpRS1XwlnbbR9ZHw+7aROgn9P1xKNz7lSIcPy3GU5eOAv9TI5dnfY9plitjR9e2nz7OHeXFej7/m6jW0uqpXH+qLy5/ri1Xz4fKwfdLuzvjtHWu0B7dXB/cNXt96odiXm9V5qv4OAAD//6huZCIQCAAA

- path: /etc/kubernetes/addons/kube-proxy.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/8xWTW/jNhO++1cQAV7siZK9eFsEBHooskGxaJMGG2zvY2psE+bXkkPXRtv/XpCSbcmylRS9VMf5eGaemYekwKvfMETlrGC7xWyrbCPYg7MrtX4CP2uAQMwYk8VSHcBowf6cMcZYP3ObluiD2x+qLnB7Hyvl6t0CtN/AoiS02D+nJb7k0LZICkDK2RIgtUJLD85alNkoipUV9BZXsHoHodZqWWejRqrPzg4jRcLw8PnTF8HuFvPq4//n1bya14uPdyXAuAYFu1OeYKkxtsYVAqWAPwFhPFb946+ZQYLjBCwYbInywpSfimZP9CCP7niIhGbGmIYl6g4PmsZZAxbWGKocFiwSliG1HX3JLKTSODtSPkd0pHjEsFO5zh2FhG3r0hnvLFrqN1c8pDAIZl3TQd5HDt4Pwjjns/4ewftYn2TwCdA4+4o0GMR/n9V4Wbe3FD3KzCWiRkkutLwMkNz80iN6q9B0rxfdJt8A4SsFIFwfWmA6+Dwmp7Wy668loNhD33LswcD+q4UdKJ21K9h38//NGCM0Xp+i+qvKnx6wmO52NN1p4mCto3J8+/jdViGRixL0SBhNUVVE4t41g6XnL8oNNilnlZvjIlcGRUqCblM/fChpxxXmzwflgqLDg4YYn4sK2kXzzIkf84/bcRrDkABnWzy0E+DBabxUNWRyp26dz/kuCPb4LZ1gGduBTjjihqsVShLs2b12LE9Fz0B3j3sVKV7LetyjTPQPk0alCr+HbhA/5gMcf7X6cI1TAT2p3BIoi6E3KumMAducl8+vaYoz3l2WPwxu7zas7j0tpxRlYI2CGRkqo2Rw0a2oks7ULsb6vJEejNgtqsV9tfh+iPGStH5xWsmDYJ9Xz45eAka0dIq6clO0X8DoUpDYk3Y2fksYaWBjTPok2GI+N2cVo0xFhs4S7qkf7oPaKY1rbATL8jhrxulk8Mkl28fnzGTLC9BGsBpJ1jHqWmI4LebMIkbNi4dvXKRB29DkHV9UHGOfRzsCR5L8qvtd4G+82pe7GLneVSQkW+/bZ73STm5H0MdHf+AcYuQmjcsHJtbj1jJ73bn/zQgmpM9YTMs25br7xo8Ib/XzVldZGc9Iv7uwHdjb7N7ZzoGljb52WyYphjpuIGAtoQhOrZSEviom9DiJ/A6Z3BDJJOwNaU8IexLups5uqmwS7qrkbguOd7p4Ai/elsXNi+6qbPKz9zr4E2Kj3zYXBdPKpv3s7wAAAP//ELctYjwMAAA=

- path: /etc/kubernetes/addons/metrics-server.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/9RWXa/bNgx9968Q8i7nFi2wwsAeujtguEB7YdwUfVckxtWiL5B01uzXD/5K4sQxmq3Bbv0SWRbJc3hIMSrZL4BkYyjE7k22tcEUYgW4sxo+aB3rwJkHVkaxKjIhgvJQCA+MVpMkwB1gv01JaSjEtl6DpD0x+EwIp9bgqLEU7RcMwEC5jUvtamLA1odtDBeMNSzak8qYGLwKqgLMx2Y+GijEC+gYtHWQSSmzUxK4VjpXNX+NaP9WbGPIt+9bywO9xy7yS3Qwwa2DXlxQvDsTrB1QkUmhkv0DY53aYFIsGk8IFGvU0O+laKhdhGjgZLUkVty/D5I0rzvAdW9aAbe/zlK3+Eux/joRFr4xhCapNAHAQHJx7yHwd7r/TzL9ZoOxoXpVakUHL7BpIgyJm2GVCXFZe/McqF7/CZrbiphsy1ub8RYJ1sBq0GFegHF02fiTCMr8z9fCv5RnpMuhAaRK9oQfBLa6NR+YvhqtvqtnxiCKvvxa5Qw4qBTHn7SFzjjcXZbzifnDRuUNWbyUpwu8+DSKvLhBR0qgGxwEDjRH7GvgPUmV0gSlFJEPgwm5EO/evW1NEkaOOrpCfH4s2x1WWAGXh1PnGVUp0XEE/H6YMj/uT8hVFneq8ulk+mYqfjzBNYeMwSenGHrTk0w0z5VsNI8bBZgnP+Bs16M2eb4eIKGNaHn/6BTR80kryiF7Gm1zW7reQMfAygbAAyo5R0AI61XVfNWYe6sxUtxwrqNfRqLlMfPLs0tt95C/zX8Zeylr58rorN4X4mnzHLlEIGivgQGc9yqYY76kWF6BJYWUTXQHLG0g0DWCZEeTBxLCBhDBSGUMApHkfQL69SkwYFDuqRykjAZWozq5LMtIhXA21N8mesciVJYYZybEh/Lp+mXVH8170seb9+6z4NglnZtstrKvdnrVDZEL/Lvjjd0lQ4hBtdXWps8fV18A7WZfiAb94Kjsq/uTDdbXvhBvHh6Ozoav3fY/AQAA//+trpg4SQ0AAA==

- path: /etc/kubernetes/addons/pod-security-policy.yaml
  permissions: \"0644\"
  encoding: gzip
  owner: \"root\"
  content: !!binary |
    H4sIAAAAAAAA/9RVTU8jORC996+w2APSSgmLVqxWfcsGWCHxEWU0XNAcKu1K8MTt8pTthMyvH9lxN+kQUAThMEeXq55fva5XDVbdIztFphSWtKpWJ4vTCXo4LebKyFKMSH7BKrDyq1G6L2r0IMFDWQhhoMZSWFYLpXGGshACjCEPXpFxMUMIh1VFte27DNMHbR+hPw8TZIMeXV/RCWhNS5QjpqnSeAs1ulIc/XlUCKFhgjpjgZRkajAwQ95CqEliKcZYkamUxsJZrGLRM7lSeA4YKcbHRk38wlWgE+FuAsohWJgorbzC9H4vM1qQDnU39EjO36JfEs9blBgbEfucWCtTir9SGzU8leKfs7O/z3La1WjYLbs6b88czMB9dchrCTjo2GcMDsyqiPpeKxOeXrsN1mqs0XjQ/zMF615JnLp0vfO21+sVB5kURudZVf7QkyKpmiOfSJxC0H49KtYC18TPaJHsPmAcjFc1dtD2opYLNtBK8W5qO8FeUjugO6ag3dv2aDIYfwTFKM+Z7LZJ4qgPrq+7NonBisxUzW7A5jPW1q/OFeejZfqOeTLi2WHF6PNB0tIsgeVgdNWkx1l0Ho2/T88MNah624gN39Zim4HksbajXSa7Cc4nD9ySGRP5D5qthVvHwMwacdr1cJqPWytihzffD8YI8s7oVezoUml0K+exbqTYtjpPoOpD8I/E6mcag/783zRSi8b4Qx2cRx6Txl0/B2fLzg/inRMb23Zl0RNgVdZWPBzjk0cTmbrjb6k3R4ErTHeWZGOwtLAUrpMWyBNXJmEejoPDTuV6BxTriWxZf4oqnWX426iywfpjqvynjFRmtkOcvN0OIxBpHOM01jUSvUG0EOLl13vlm7kwiQsrqb8uSuhtevZVfAaNVxXkv94eLD5b2IP48bDCblD6TGHfAjQk0e0J9MfF3WXxKwAA//+Y7F5+PQsAAA==



- path: /etc/default/kubelet
  permissions: \"0644\"
  owner: root
  content: |
    KUBELET_CONFIG=--address=0.0.0.0 --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --azure-container-registry-config=/etc/kubernetes/azure.json --cgroups-per-qos=true --client-ca-file=/etc/kubernetes/certs/ca.crt --cloud-config=/etc/kubernetes/azure.json --cloud-provider=azure --cluster-dns=10.0.0.10 --cluster-domain=cluster.local --enforce-node-allocatable=pods --event-qps=0 --eviction-hard=memory.available<750Mi,nodefs.available<10%,nodefs.inodesFree<5% --feature-gates=RotateKubeletServerCertificate=true --healthz-port=10248 --image-gc-high-threshold=85 --image-gc-low-threshold=80 --image-pull-progress-deadline=30m --keep-terminated-pod-volumes=false --kubeconfig=/var/lib/kubelet/kubeconfig --max-pods=30 --network-plugin=cni --node-status-update-frequency=10s --non-masquerade-cidr=0.0.0.0/0 --pod-infra-container-image=mcr.microsoft.com/oss/kubernetes/pause:1.4.1 --pod-manifest-path=/etc/kubernetes/manifests --pod-max-pids=-1 --protect-kernel-defaults=true --read-only-port=0 --register-with-taints=node-role.kubernetes.io/master=true:NoSchedule --resolv-conf=/run/systemd/resolve/resolv.conf --rotate-certificates=true --streaming-connection-idle-timeout=4h --tls-cert-file=/etc/kubernetes/certs/kubeletserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --tls-private-key-file=/etc/kubernetes/certs/kubeletserver.key --v=2 --volume-plugin-dir=/etc/kubernetes/volumeplugins 
    KUBELET_NODE_LABELS=kubernetes.azure.com/role=master,node.kubernetes.io/exclude-from-external-load-balancers=true,node.kubernetes.io/exclude-disruption=true,kubernetes.azure.com/cluster=',variables('labelResourceGroup'),'
    #EOF

- path: /opt/azure/containers/kubelet.sh
  permissions: \"0755\"
  owner: root
  content: |
    #!/bin/bash
    set -e
    MOUNT_DIR=/var/lib/kubelet
    mkdir -p $MOUNT_DIR /var/lib/cni
    if ! [[ $(findmnt -rno SOURCE,TARGET ${MOUNT_DIR}) ]]; then
      mount --bind $MOUNT_DIR $MOUNT_DIR
    fi
    mount --make-shared $MOUNT_DIR
    iptables -I FORWARD -d 168.63.129.16 -p tcp --dport 80 -j DROP
    #EOF
- path: /etc/systemd/system/etcd.service
  permissions: \"0644\"
  encoding: gzip
  owner: root
  content: !!binary |
    ',variables('cloudInitFiles').etcdSystemdService,'

- path: /opt/azure/containers/setup-etcd.sh
  permissions: \"0744\"
  owner: root
  content: |
    #!/bin/bash
    set -x
    if [[ ! -s /etc/environment ]]; then
        echo \"\" >> /etc/environment
    fi
    sudo sed -i \"1iETCDCTL_ENDPOINTS=https://127.0.0.1:2379\" /etc/environment
    sudo sed -i \"1iETCDCTL_CA_FILE=',variables('etcdCaFilepath'),'\" /etc/environment
    sudo sed -i \"1iETCDCTL_KEY_FILE=',variables('etcdClientKeyFilepath'),'\" /etc/environment
    sudo sed -i \"1iETCDCTL_CERT_FILE=',variables('etcdClientCertFilepath'),'\" /etc/environment
    sudo sed -i \"/^DAEMON_ARGS=/d\" /etc/default/etcd
    /bin/echo DAEMON_ARGS=--name \"',variables('masterVMNames')[copyIndex(variables('masterOffset'))],'\" --peer-client-cert-auth --peer-trusted-ca-file=',variables('etcdCaFilepath'),' --peer-cert-file=',variables('etcdPeerCertFilepath')[copyIndex(variables('masterOffset'))],' --peer-key-file=',variables('etcdPeerKeyFilepath')[copyIndex(variables('masterOffset'))],' --initial-advertise-peer-urls \"',variables('masterEtcdPeerURLs')[copyIndex(variables('masterOffset'))],'\" --listen-peer-urls \"',variables('masterEtcdPeerURLs')[copyIndex(variables('masterOffset'))],'\" --client-cert-auth --trusted-ca-file=',variables('etcdCaFilepath'),' --cert-file=',variables('etcdServerCertFilepath'),' --key-file=',variables('etcdServerKeyFilepath'),' --advertise-client-urls \"',variables('masterEtcdClientURLs')[copyIndex(variables('masterOffset'))],'\" --listen-client-urls \"',concat(variables('masterEtcdClientURLs')[copyIndex(variables('masterOffset'))], ',https://127.0.0.1:', variables('masterEtcdClientPort')),'\" --initial-cluster-token \"k8s-etcd-cluster\" --initial-cluster ',variables('masterEtcdClusterStates')[div(variables('masterCount'), 2)],' --data-dir \"/var/lib/etcddisk\" --initial-cluster-state \"new\" --listen-metrics-urls \"',variables('masterEtcdMetricURLs')[copyIndex(variables('masterOffset'))],'\" --quota-backend-bytes=2147483648 | tee -a /etc/default/etcd
  

    #EOF

disk_setup:
  /dev/disk/azure/scsi1/lun0:
    table_type: gpt
    layout: true
    overwrite: false
fs_setup:
  - label: etcd_disk
    filesystem: ext4
    device: /dev/disk/azure/scsi1/lun0
    extra_opts:
      - -E
      - lazy_itable_init=1,lazy_journal_init=1
  - label: ephemeral0
    filesystem: ext4
    device: ephemeral0.1
    replace_fs: ntfs
mounts:
  - - LABEL=etcd_disk
    - /var/lib/etcddisk
runcmd:
- set -x
- source /opt/azure/containers/provision_source.sh
- aptmarkWALinuxAgent hold
